version: 2

sources:
  - name: raw # required
    description: GreenWeez Raw Dataset
    # database: <database_name>
    schema: gz_raw_data
    # loader: <string>
    # loaded_at_field: <column_name>
    # meta: {<dictionary>}
    # tags: [<string>]
    
    # # requires v1.1+
    # config:
    #   <source_config>: <config_value>
    #   freshness: 
    #     # changed to config in v1.9
    #     warn_after:
    #       count: <positive_integer>
    #       period: minute | hour | day
    #     error_after:
    #       count: <positive_integer>
    #       period: minute | hour | day
    #     filter: <where-condition>
      
    # overrides: <string>

    # quoting:
    #   database: true | false
    #   schema: true | false
    #   identifier: true | false

    tables:
      - name: sales
        identifier: raw_gz_sales
        description: has raw sales data entity
        # constraints:
        #   - type: primary_key
        #     columns: [orders_id, pdt_id]
        config:
          freshness:
            warn_after:
              count: 90
              period: day
            # error_after:
            #   count: 4
            #   period: day
        columns:
          - name: date_date # required
            description: sales of Greenweez / order date

            # description: <markdown_string>
            # tests:
            #   - test_case # declare  tests
          - name: orders_id # required
            description: sales of Greenweez / we have on row per product_id found in each orders_id
          - name: pdt_id
            description: product ID / reference key for products table
          - name: revenue
            description: total turnover per order
          - name: quantity
            description: quanity of products per order
            # description: <markdown_string>
            # tests:
            #   - test_case # declare  tests
        # tests:
          # - unique:
          #     combination_of: ['orders_id', 'pdt_id']
          # - dbt_utils.unique_combination_of_columns:
          #   combination_of_columns:
          #     - orders_id
          #     - pdt_id


      - name: product
        identifier: raw_gz_product
        description: Has raw product data entity
        columns:
          - name: products_id
            description: unique product ID for GWZ
            tests:
              - unique
              - not_null
          - name: purchSE_PRICE
            description: product purchase price

      - name: ship
        identifier: raw_gz_ship
        description: Has raw shipping data entity
        columns:
          - name: orders_id
            description: FK / PK for sales table / order id for the shipment
            tests:
              - unique
              - not_null
          - name: shipping_fee
            description: shipping fee charged from the client
          - name: shipping_fee_1
          - name: logCost
            description: actual logging cost for the shipping
          - name: ship_cost
            description: actual shipping cost incurred for the shipment

      # - name: <string> #required
      #   description: <markdown_string>
      #   # meta: {<dictionary>}
      #   # identifier: <table_name>
      #   # loaded_at_field: <column_name>
      #   tests:
      #     - <test>
      #     - ... # declare additional tests
      #   # tags: [<string>]
      #   # config:
      #   #   freshness:
      #   #     warn_after:
      #   #       count: <positive_integer>
      #   #       period: minute | hour | day
      #   #     error_after:
      #   #       count: <positive_integer>
      #   #       period: minute | hour | day
      #   #     filter: <where-condition>

      #   # quoting:
      #   #   database: true | false
      #   #   schema: true | false
      #   #   identifier: true | false
      #   # external: {<dictionary>}
      #   columns:
      #     - name: <column_name> # required
      #       description: <markdown_string>
      #       meta: {<dictionary>}
      #       quote: true | false
      #       tests:
      #         - <test>
      #         - ... # declare additional tests
      #       tags: [<string>]
      #     - name: ... # declare properties of additional columns

      # - name: ... # declare properties of additional source tables

  # - name: ... # declare properties of additional sources


models:
  - name: finance_days
    description: Final aggregated table for sales team
    columns:
      - name: date_date
        description: PK for the table
        tests:
          - unique
          - not_null
      - name: transactions_count
        description: count of transaction on a day
      - name: total_revenue
        description: total revenue for the day
      - name: average_basket_value
        description: daily average_basket_value
      - name: margin
        description: total margin for the day
      
    # ROUND(SUM(o.operational_margin),2) as operational_margin,
    # ROUND(SUM(o.purchase_cost),2) as total_purchase_cost,
    # ROUND(SUM(o.ship_cost),2) as total_ship_cost,
    # ROUND(SUM(o.log_cost),2) as total_log_cost,
    # ROUND(SUM(o.quantity),2) as total_quantity_sold
  - name: int_orders_margin
    description: Final aggregated table for sales team

  - name: int_orders_operational
    description: Final aggregated table for sales team

  - name: int_sales_margin
    description: Final aggregated table for sales team

  - name: stg_product
    description: Final aggregated table for sales team
    columns:
      - name: products_id
        description: PK for the table
        tests:
          - unique
          - not_null

  - name: stg_sales
    description: Final aggregated table for sales team
    
  - name: stg_ship
    description: Final aggregated table for sales team
    columns:
      - name: orders_id
        description: PK for the table
        tests:
          - unique
          - not_null